# 🚜 Sistema de Controle de Tráfego de Máquinas na Colheita de Cana

## 1️⃣ Contexto do Projeto

A colheita mecanizada de cana-de-açúcar tem se tornado essencial para o aumento da produtividade no agronegócio brasileiro.  
Entretanto, o tráfego desordenado das máquinas agrícolas durante a colheita provoca **compactação do solo**, o que reduz a produtividade e eleva as perdas da lavoura.

Segundo estudos da **CHB Agro** e **SOCICANA**, as perdas podem chegar a **15% da produção** devido à má gestão do deslocamento das colhedoras e caminhões.

Este projeto propõe uma **solução computacional em Python (FastAPI)** para **analisar e otimizar o tráfego das máquinas** na lavoura, reduzindo sobreposições e otimizando o rendimento operacional.

---

## 2️⃣ Objetivo

Desenvolver um sistema capaz de:

- 📡 **Registrar em tempo real** os trajetos das máquinas agrícolas (colhedoras, tratores, caminhões);
- 📍 **Coletar coordenadas GPS continuamente** durante a colheita;
- 🧮 **Calcular distâncias percorridas e áreas colhidas**;
- ⚠️ **Detectar sobreposições de rota** entre diferentes máquinas;
- 🗺️ **Gerar mapas e relatórios de análise JSON e PDF** (em desenvolvimento);
- 💾 **Armazenar dados persistentemente em banco Oracle**;
- 🚦 **Simular coleta automática de coordenadas** via threads (para testes sem GPS real).

---

## 3️⃣ Banco de Dados Oracle

### 🧰 Maquinas
```sql
CREATE TABLE maquinas (
    id INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    modelo VARCHAR2(100) NOT NULL,
    tipo VARCHAR2(50) NOT NULL,
    ano_fabricacao NUMBER(4),
    status NUMBER(1) DEFAULT 1
);
```

### 🌾 Colheitas
```sql
CREATE TABLE colheitas (
    id INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    maquina_id INT NOT NULL,
    inicio TIMESTAMP DEFAULT SYSTIMESTAMP,
    fim TIMESTAMP,
    status VARCHAR2(30) DEFAULT 'Em andamento',
    area_colhida NUMBER(10,2),
    duracao NUMBER(10,2),
    FOREIGN KEY (maquina_id) REFERENCES maquinas(id)
);
```

### 📍 Pontos de Trajeto
```sql
CREATE TABLE pontos_trajeto (
    id INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    colheita_id INT NOT NULL,
    latitude NUMBER(10,6) NOT NULL,
    longitude NUMBER(10,6) NOT NULL,
    data_registro TIMESTAMP DEFAULT SYSTIMESTAMP,
    FOREIGN KEY (colheita_id) REFERENCES colheitas(id)
);
```

---

## 4️⃣ Tecnologias Utilizadas

- 🐍 **Python 3.9+**
- ⚡ **FastAPI** (API moderna e assíncrona)
- 🔥 **Uvicorn** (servidor ASGI)
- 🧱 **Oracle Database**
- 🧩 **Pydantic v2** (validação de dados)
- 🧠 **Threading + Simulação de GPS**
- 📊 (Em desenvolvimento) Relatórios PDF e análise de sobreposição

---

## 5️⃣ Como Rodar o Projeto

1️⃣ **Instalar as dependências**
```bash
pip install -r requirements.txt
```

2️⃣ **Executar o servidor FastAPI**
```bash
uvicorn app.main:app --reload
```

3️⃣ **Acessar a documentação interativa (Swagger UI)**
```
http://127.0.0.1:8000
```

---

## 6️⃣ Endpoints Principais

### 🔧 Máquinas (`/maquinas`)
- `POST /maquinas/cadastrar` — Cadastra nova máquina
- `GET /maquinas/listar` — Lista todas as máquinas
- `PUT /maquinas/editar/{id}` — Edita uma máquina
- `DELETE /maquinas/excluir/{id}` — Exclui uma máquina

### 🌾 Colheitas (`/colheitas`)
- `POST /colheitas/iniciar` — Inicia colheita (simulação de GPS em background)
- `PUT /colheitas/finalizar/{id}` — Finaliza colheita e calcula área/duração
- `GET /colheitas/listar` — Lista todas as colheitas com dados de máquinas

### 🧭 Análise de Tráfego (em desenvolvimento)
- `GET /analise/trafego/{colheita_id}` — Calcula e retorna sobreposições entre máquinas e coordenadas para mapa.

---

## 7️⃣ Resultados Esperados

- 📈 Monitoramento contínuo do tráfego de colhedoras;
- 📉 Redução da compactação do solo e das sobreposições de rota;
- 🧮 Cálculo de área colhida em hectares com base em coordenadas GPS;
- 🗺️ Geração futura de mapa interativo com áreas sobrepostas destacadas.
